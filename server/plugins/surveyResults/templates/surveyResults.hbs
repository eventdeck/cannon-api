<html>
<head>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
  <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css' rel='stylesheet'>
  <link href='//fonts.googleapis.com/css?family=Roboto:100,300,700' rel='stylesheet' type='text/css'>
  <script src="Chart.min.js" type="text/javascript"></script>


  <style type='text/css'>
    body {
      background: white;
      font-family: Roboto, sans-serif;
      font-size: 8px;
    }
  </style>
  
  <script type="text/javascript">  
    var isIST = function(res) {
      var p = document.getElementById('ist');
      res['isIST'] ? p.innerHTML += res['isIST'] : p.innerHTML = "";
    }
    
    var chart = function (id, res, responses, cb) {
      if(!res) return cb("Error");
      
      var ctx = document.getElementById(id).getContext("2d");
      var data = [];

      for (var r in res) {
        data.push({
            value: (res[r] / responses * 100).toFixed(2),
            color:"#F7464A",
            highlight: "#FF5A5E",
            label: r
        });
      }
      
      if (!data) return cb("Error");
      cb(null, ctx, data)
    }
    
    var pieChart = function (id, res, responses) {
      chart(id, res, responses, function(error, ctx, data) {
        if(!error) {
         new Chart(ctx).Pie(data);
        }
      });
    }
    
    window.onload = function() {
      var res = {{{results}}};
      pieChart("ageChart", res['age'], res['responses']);
      pieChart("genderChart", res['gender'], res['responses']);
      pieChart("areaChart", res['area'], res['responses']);
      isIST(res);
      pieChart("satisfactionChart", res['satisfaction'], res['responses']);

      //logistics
      pieChart("instalationsChart", res['logistics']['instalation'], res['responses']);
      pieChart("locationChart", res['logistics']['location'], res['responses']);
      pieChart("organizationChart", res['logistics']['organization'], res['responses']);
      pieChart("communicationChart", res['logistics']['communication'], res['responses']);

      //session
      pieChart("session-organizationChart", res['session']['organization'], res['responses']);
      pieChart("contentChart", res['session']['content'], res['responses']);
      pieChart("speakerChart", res['session']['speaker'], res['responses']);
      pieChart("durationChart", res['session']['duration'], res['responses']);
      pieChart("recommendChart", res['session']['recommend'], res['responses']);

    }
  </script>

  <title>Survey Results</title>
</head>
<body>
  <h1>Survey Results</h1>
  <canvas id="ageChart" width="400" height="400"></canvas>
  <canvas id="genderChart" width="400" height="400"></canvas>
  <canvas id="areaChart" width="400" height="400"></canvas>
  <p id="ist">NÃºmero de alunos do IST: </p>
  <canvas id="satisfactionChart" width="400" height="400"></canvas>
  
  <h2>Logistics</h2>
  <canvas id="instalationsChart" width="400" height="400"></canvas>
  <canvas id="locationChart" width="400" height="400"></canvas>
  <canvas id="organizationChart" width="400" height="400"></canvas>
  <canvas id="communicationChart" width="400" height="400"></canvas>
  
  <h2>Session</h2>
  <canvas id="session-organizationChart" width="400" height="400"></canvas>
  <canvas id="contentChart" width="400" height="400"></canvas>
  <canvas id="speakerChart" width="400" height="400"></canvas>
  <canvas id="durationChart" width="400" height="400"></canvas>
  <canvas id="recommendChart" width="400" height="400"></canvas>
</body>
</html>